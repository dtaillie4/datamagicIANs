library(sf) 
library(ggplot2)


#Social Vulnerability Data

tractUS_svi <- st_read("data/SVI2016_US/SVI2016_US.shp")
View(tractUS_svi)

ggplot(tractUS_svi, 
       aes(geometry = geometry,
           fill = RPL_THEMES)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Socioeconomic status", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))


CB_states <- filter(tractUS_svi, STATE %in% c("MARYLAND", "DELEWARE", "NEW YORK", "VIRGINIA", "WEST VIRGINIA", "PENNSYLVANIA", "DISTRICTOFCOLUMBIA"))
?filter

ggplot(CB_states, 
       aes(geometry = geometry,
           fill = RPL_THEMES)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Socioeconomic status", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))



#transform projections and clip CM watershed

CB <- st_read('data/Chesapeake Bay and major watersheds.shp')


prj <- '+proj=aea +lat_1=29.5 +lat_2=45.5 \
    +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0    \
    +ellps=GRS80 +towgs84=0,0,0,0,0,0,0   \
    +units=m +no_defs'

CB_transform <- st_transform(
  CB,
  crs = prj)

SVI_transform <- st_transform(
  CB_states,
  crs = prj)

CHES_SVI <- st_intersection(CB_transform, SVI_transform)


#Plotting Vulnerability Index and themes

#Overall Social Vulnerability Percentile Rank
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = RPL_THEMES)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Overall Social Vulnerability", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

#Theme 1 Socioeconomic status Percentile Rank
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = RPL_THEME1)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Socioeconomic status", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

#Theme 2 Household Composition and Disability Percentile Rank
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = RPL_THEME2)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Household Composition & Disability", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

#Theme 3 Minority Status & Language Percentile Rank
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = RPL_THEME3)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Minority Status & Language", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

#Theme 4 Housing and Transportation Percentile Rank
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = RPL_THEME4)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Housing & Transportation", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

#Percentile Percentage of persons below poverty estimate
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = EPL_POV)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Percentage of persons below poverty", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

#Percentile Percentage of civilian (age 16+) unemployed estimate
ggplot(CHES_SVI, 
       aes(geometry = geometry,
           fill = EPL_UNEMP)) + geom_sf(size=0.01) + 
  scale_fill_gradientn(colours=c("green","light green", "yellow", "orange", "red"), name="Percentage of unemployed civilian (age 16+)", na.value = "transparent",
                       breaks=c(0.1,0.3,0.5,0.7,0.90),labels=c("A","B","C","D","F"),limits=c(0,1))

